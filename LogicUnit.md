# 8 Function Logic Unit

Note: Please read [The War on Voltage Drop](Voltage.md) for context on the revision history of the PCB boards.

This board generates the 6 useful logic functions (AND, OR, XOR, NAND, NOR and XNOR) as well as the two useless ones (TRUE and FALSE) on two 16-bit inputs.

# Revision 1.0

![16 Bit Logic Unit 1.0](/Images/LogicUnit.jpg)

Operation selection is done through 3 control signals (AND, XOR, and NOT). There are two stages to the unit; in the first, AND and XOR are computed as needed;
they are then OR'd and optionally NOTted. OR is generated by computing both AND and XOR at the same time.

The circuit design is inspired by the Zuse adder, in that the operation selection signals for AND and XOR energize two circuit paths, and the state of two relays
is controlled by the input bits; this determines whether or not the signals get through the relays to the NOT relay. Since AND and XOR are exclusive to each other (AND(a,b) != XOR(a,b)), there is no possibility of backfeed between the circuits and their outputs can simply be connected together to OR them.

That said, my battles with backfeed are not over; see below for an important gotcha!

The desired operation can be hardwired for the entire board or on a per-bit basis using solder bridges.

[![YouTube Video](https://img.youtube.com/vi/KSzZ73obGIc/0.jpg)](https://youtu.be/KSzZ73obGIc)

A short video showing the Revision 1.0 board being tested is available on [YouTube](https://youtu.be/KSzZ73obGIc).

# Board Design Mistakes

One of my goals with the board design was to minimize power usage by disabling relays when the board was not ACTIVE. This was done by routing all of the relay grounds onto
an ENABLE circuit, and connecting that to GND via a relay. If that relay wasn't activated, no connection to GND, and none of the other relays could operate.

This design fails if there is any connection, however convoluted, between the ENABLE circuit and GND. And unfortunately, when the board is connected to the IO Expander (and thus,
the Raspberry Pi), there is such a connection: backwards through any relay coil, out through one of the connectors, to the IO Expander, and then through the data line's pulldown
resistor!

To paraphrase Ian Malcolm, "Electricity finds a way." :(

This situation is made even worse because +3V3 is routed through the ACTIVE LED to the ENABLE circuit. This means that when the board is connected to the IO Expander, that LED
(and some of the DATA leds) glow faintly.

The board still operates as expected, but the mistake is troubling and it's a recipe for weird problems down the line. Thus I am redesigning this board, and all the other boards
that I revised to use this ENABLE system, so that all relays always connect directly to GND.

In the meantime, the workaround is to not install the ENABLE relays and solder-bridge the board so it's always ENABLED. This makes the ENABLE circuit equivalent to GND.

A second error is that if the NOT relay is not populated, and NOT is not activated, the NC relay connections need to be bridged in order for the other logical functions to operate properly. I omitted solder jumpers for this functionality. The workaround is to use some 0-ohm SMT resistors as jumper wires.

# Revision 2.0

![16 Bit Logic Unit 2.0](/Images/LogicUnit-Rev2.jpeg)

Revision 2.0 of the board incorporates all of the lessons learned during the War on Voltage Drop. In addition, the unused space on the board has been filled with a relay breadboard that may come in handy; this is configured like the bit test unit on the register board, so it can easily be wired to do bit value tests if needed.

This board has been manufactured and tested. The only mistake I've noticed so far is that I swapped the labels on the ALWAYS and NEVER NOT-Control jumpers. This has been corrected in the 2.1 revision.

# Resources

* [Board Test Script](/HardwareTests/LogicUnit.py).

* [EasyEda Project](https://easyeda.com/MadOverlord/relay-boolean-logic-unit), [Gerber Files](/Gerber/Logic.zip) and [BOM](/BOMs/Logic.csv) for the latest boards.

* Boards were manufactured by [JLCPCB](https://jlcpcb.com/). Parts were sourced from [LCSC](https://lcsc.com/) and [Digikey](https://www.digikey.com/).
